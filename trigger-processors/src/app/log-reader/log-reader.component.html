<div class="log-reader-container">
  <h2>TPR</h2>
  
  <div class="main-layout">
    <!-- Main Content -->
    <div class="main-panel">
      <!-- Tab Navigation -->
      <div class="tab-navigation">
        <button 
          class="tab-button" 
          [class.active]="activeTab === 'l1'"
          (click)="setActiveTab('l1')">
          L1 Processor
        </button>
        <button 
          class="tab-button" 
          [class.active]="activeTab === 'l3'"
          (click)="setActiveTab('l3')">
          L3 Processor
        </button>
        <button 
          class="tab-button" 
          [class.active]="activeTab === 'cleanup'"
          (click)="setActiveTab('cleanup')">
          Cleanup
        </button>
      </div>

      <!-- Tab Content -->
      <div class="tab-content">
    <!-- L1 Search Section -->
    <div class="search-section" *ngIf="activeTab === 'l1'">
      <h3>L1 Processor</h3>
      <div class="search-form">
        <div class="input-group">
          <label for="l1-patient-id">Patient ID(s):</label>
          <input 
            type="text" 
            id="l1-patient-id"
            [(ngModel)]="l1PatientId"
            placeholder="Enter Patient ID(s) separated by commas"
            class="search-input">
          <small class="input-help">Enter multiple Patient IDs separated by commas (e.g., ID1, ID2, ID3)</small>
        </div>
        <button 
          type="button" 
          (click)="onL1Search()"
          [disabled]="l1Loading"
          class="submit-button">
          {{ l1Loading ? 'Processing...' : 'Submit' }}
        </button>
      </div>

      <!-- L1 Response Display -->
      <div class="response-section" *ngIf="l1Response || l1Error">
        <div class="error-message" *ngIf="l1Error">
          <strong>Error:</strong> {{ l1Error }}
        </div>
        <div class="response-message" *ngIf="l1Response">
          <div class="response-header">
            <strong>Response:</strong>
            <span class="status-badge" [class.success]="isSuccess(l1Response)" [class.error]="!isSuccess(l1Response)">
              {{ isSuccess(l1Response) ? 'Success' : 'Failed' }}
            </span>
          </div>
          <div class="response-details">
            <p><strong>Level:</strong> {{ l1Response.level }}</p>
            <p><strong>Message:</strong> {{ l1Response.message }}</p>
            <p><strong>Result:</strong> {{ l1Response.result }}</p>
            <p><strong>Patient IDs:</strong> {{ l1Response.patient_ids.join(', ') || 'None' }}</p>
          </div>
        </div>
      </div>
    </div>

    <!-- L3 Processor Section -->
    <div class="search-section" *ngIf="activeTab === 'l3'">
      <h3>L3 Processor</h3>
      <div class="search-form">
        <div class="input-group">
          <label for="l3-patient-id">Patient ID(s):</label>
          <input 
            type="text" 
            id="l3-patient-id"
            [(ngModel)]="l3PatientId"
            placeholder="Enter Patient ID(s) separated by commas"
            class="search-input">
          <small class="input-help">Enter multiple Patient IDs separated by commas (e.g., ID1, ID2, ID3)</small>
        </div>
        <button 
          type="button" 
          (click)="onL3Search()"
          [disabled]="l3Loading"
          class="submit-button">
          {{ l3Loading ? 'Processing...' : 'Submit' }}
        </button>
      </div>

      <!-- L3 Response Display -->
      <div class="response-section" *ngIf="l3Response || l3Error">
        <div class="error-message" *ngIf="l3Error">
          <strong>Error:</strong> {{ l3Error }}
        </div>
        <div class="response-message" *ngIf="l3Response">
          <div class="response-header">
            <strong>Response:</strong>
            <span class="status-badge" [class.success]="isSuccess(l3Response)" [class.error]="!isSuccess(l3Response)">
              {{ isSuccess(l3Response) ? 'Success' : 'Failed' }}
            </span>
          </div>
          <div class="response-details">
            <p><strong>Level:</strong> {{ l3Response.level }}</p>
            <p><strong>Message:</strong> {{ l3Response.message }}</p>
            <p><strong>Result:</strong> {{ l3Response.result }}</p>
            <p><strong>Log Count:</strong> {{ l3Response.log_count }} entries found</p>
          </div>
          
          <!-- L3 Logs Display -->
          <div class="logs-section" *ngIf="l3Response.logs && l3Response.logs.length > 0">
            <h4>L3 Processing Logs for Patient {{ l3Response.result }}</h4>
            <div class="log-content">
              <div 
                class="log-line" 
                *ngFor="let logLine of l3Response.logs">
                <span class="log-timestamp">{{ parseLogLine(logLine).timestamp }}</span>
                <span class="log-level" [class]="'level-' + parseLogLine(logLine).level.toLowerCase()">
                  [{{ parseLogLine(logLine).level }}]
                </span>
                <span class="log-message">{{ parseLogLine(logLine).message }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Cleanup Section -->
    <div class="search-section" *ngIf="activeTab === 'cleanup'">
      <h3>Cleanup</h3>
      <div class="search-form">
        <div class="input-group">
          <label for="cleanup-patient-id">Patient ID(s):</label>
          <input 
            type="text" 
            id="cleanup-patient-id"
            [(ngModel)]="cleanupPatientId"
            placeholder="Enter Patient ID(s) separated by commas"
            class="search-input">
          <small class="input-help">Enter multiple Patient IDs separated by commas (e.g., ID1, ID2, ID3)</small>
        </div>
        <button 
          type="button" 
          (click)="onCleanupSearch()"
          [disabled]="cleanupLoading"
          class="submit-button">
          {{ cleanupLoading ? 'Processing...' : 'Submit' }}
        </button>
      </div>

      <!-- Cleanup Response Display -->
      <div class="response-section" *ngIf="cleanupResponse || cleanupError">
        <div class="error-message" *ngIf="cleanupError">
          <strong>Error:</strong> {{ cleanupError }}
        </div>
        <div class="response-message" *ngIf="cleanupResponse">
          <div class="response-header">
            <strong>Response:</strong>
            <span class="status-badge" [class.success]="isSuccess(cleanupResponse)" [class.error]="!isSuccess(cleanupResponse)">
              {{ isSuccess(cleanupResponse) ? 'Success' : 'Failed' }}
            </span>
          </div>
          <div class="response-details">
            <p><strong>Level:</strong> {{ cleanupResponse.level }}</p>
            <p><strong>Message:</strong> {{ cleanupResponse.message }}</p>
            <p><strong>Result:</strong> {{ cleanupResponse.result }}</p>
            <p><strong>Log Count:</strong> {{ cleanupResponse.log_count }} entries found</p>
          </div>
          
          <!-- Cleanup Logs Display -->
          <div class="logs-section" *ngIf="cleanupResponse.logs && cleanupResponse.logs.length > 0">
            <h4>Cleanup Processing Logs for Patient {{ cleanupResponse.result }}</h4>
            <div class="log-content">
              <div 
                class="log-line" 
                *ngFor="let logLine of cleanupResponse.logs">
                <span class="log-timestamp">{{ parseLogLine(logLine).timestamp }}</span>
                <span class="log-level" [class]="'level-' + parseLogLine(logLine).level.toLowerCase()">
                  [{{ parseLogLine(logLine).level }}]
                </span>
                <span class="log-message">{{ parseLogLine(logLine).message }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
