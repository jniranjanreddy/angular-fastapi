<div class="sidebar" [class.collapsed]="isCollapsed">
  <!-- Sidebar Header -->
  <div class="sidebar-header">
    <button class="toggle-btn" (click)="toggleSidebar()">
      <span *ngIf="!isCollapsed">←</span>
      <span *ngIf="isCollapsed">→</span>
    </button>
  </div>

  <!-- Dashboard Sections Container -->
  <div class="dashboard-sections">
    
    <!-- TPR Dashboard Section (Top Half) -->
    <div class="dashboard-section tpr-section">
        <div class="dashboard-header" *ngIf="!isCollapsed" 
             [class.active]="activeDashboard === 'tpr'"
             (click)="setActiveDashboard('tpr')">
        <h4>TPR</h4>
      </div>
      
      <!-- TPR Environment Selection -->
      <div class="environment-section">
        <div class="section-header" *ngIf="!isCollapsed">
          <h5>Environment</h5>
        </div>

        <!-- Loading State -->
        <div class="loading-state" *ngIf="isLoading">
          <div class="spinner"></div>
          <span *ngIf="!isCollapsed">Loading environments...</span>
        </div>

        <!-- Error State -->
        <div class="error-state" *ngIf="error && !isLoading">
          <div class="error-icon">⚠️</div>
          <span *ngIf="!isCollapsed">{{ error }}</span>
          <button class="retry-btn" (click)="loadUserEnvironments()" *ngIf="!isCollapsed">
            Retry
          </button>
        </div>

        <!-- TPR Environment List -->
        <div class="environment-list" *ngIf="userEnvironments && !isLoading && !error">
          <div 
            class="environment-item"
            *ngFor="let envKey of userEnvironments.available_keys"
            [class.selected]="selectedTprEnvironment === envKey"
            (click)="selectTprEnvironment(envKey)"
          >
            <div class="env-info" *ngIf="!isCollapsed">
              <div class="env-name">{{ getEnvironmentDisplayName(envKey) }}</div>
              <div class="env-key">{{ envKey }}</div>
            </div>
            <div class="env-status" *ngIf="selectedTprEnvironment === envKey && activeDashboard === 'tpr'">
              <span class="active-indicator"></span>
            </div>
          </div>
        </div>
      </div>

    </div>

    <!-- Separator -->
    <div class="dashboard-separator" *ngIf="!isCollapsed"></div>

    <!-- Formulary Dashboard Section (Bottom Half) -->
    <div class="dashboard-section formulary-section">
        <div class="dashboard-header" *ngIf="!isCollapsed" 
             [class.active]="activeDashboard === 'formulary'"
             (click)="setActiveDashboard('formulary')">
        <h4>Formulary</h4>
      </div>
      
      <!-- Formulary Environment Selection -->
      <div class="environment-section">
        <div class="section-header" *ngIf="!isCollapsed">
          <h5>Environment</h5>
        </div>

        <!-- Formulary Environment List -->
        <div class="environment-list" *ngIf="userEnvironments && !isLoading && !error">
          <div 
            class="environment-item"
            *ngFor="let envKey of userEnvironments.available_keys"
            [class.selected]="selectedFormularyEnvironment === envKey"
            (click)="selectFormularyEnvironment(envKey)"
          >
            <div class="env-info" *ngIf="!isCollapsed">
              <div class="env-name">{{ getEnvironmentDisplayName(envKey) }}</div>
              <div class="env-key">{{ envKey }}</div>
            </div>
            <div class="env-status" *ngIf="selectedFormularyEnvironment === envKey && activeDashboard === 'formulary'">
              <span class="active-indicator"></span>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>

</div>

